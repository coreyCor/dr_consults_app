<h1>Editing: <%= @user.name.presence || "Unnamed User" %></h1>

<% if @user.errors.any? %>
  <div class="alert alert-danger">
    <h4>The following errors prevented the user from being saved:</h4>
    <ul>
      <% @user.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%= form_with(model: [:admin, @user], local: true) do |f| %>
  <div class="mb-3">
    <%= f.label :name %>
    <%= f.text_field :name, class: "form-control" %>
  </div>

  <div class="mb-3">
    <%= f.label :email %>
    <%= f.email_field :email, class: "form-control" %>
  </div>

  <div class="mb-3">
    <%= f.label :user_role %>
    <%= f.select :user_role, [["User", "user"], ["Admin", "admin"]], {}, class: "form-select" %>
  </div>

  <div class="mb-3 form-check">
  <%= f.check_box :can_accept_fbx_neo, class: "form-check-input" %>
  <%= f.label :can_accept_fbx_neo, "Eligible for FBX NEO consults", class: "form-check-label" %>
</div>

  <div class="mb-3">
    <%= f.label :daily_consult_limit %>
    <%= f.number_field :daily_consult_limit, class: "form-control", min: 0 %>
  </div>

  <div class="mb-3">
    <%= f.label :cooldown_minutes %>
    <%= f.number_field :cooldown_minutes, class: "form-control", min: 0 %>
  </div>

  <div class="mb-3">
    <%= f.label :time_zone, "Time Zone" %>
    <%= f.select :time_zone,
      [
        ["US Pacific", "Pacific Time (US & Canada)"],
        ["US Central", "Central Time (US & Canada)"],
        ["US Eastern", "Eastern Time (US & Canada)"],
        ["US Mountain", "Mountain Time (US & Canada)"],
        ["Alaska", "Alaska"], 
        ["Hawaii", "Hawaii"],
        ["United Kingdom", "London"]
      ],
      { prompt: "Select a Time Zone" },
      class: "form-select"
    %>
  </div>

  <p class="text-muted">
    User Time Zone: <%= @user.time_zone %> <br>
    Current Local Time: <%= @user.local_time.strftime("%I:%M %p") %>
  </p>

  <h3>Weekly Availability</h3>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Day</th>
        <th>Start Time</th>
        <th>End Time</th>
      </tr>
    </thead>
    <tbody>
      <% Date::DAYNAMES.each_with_index do |day_name, i| %>
        <% availability = @user.availability_for(i) || @user.availabilities.build(day_of_week: i) %>
        <%= f.fields_for :availabilities, availability do |af| %>
          <tr>
            <td><%= day_name %></td>
            <td><%= af.time_field :start_time, class: "form-control", step: 60 %></td>
            <td><%= af.time_field :end_time, class: "form-control", step: 60 %></td>
            <%= af.hidden_field :day_of_week, value: i %>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>

  <%= f.submit "Update User", class: "btn btn-primary" %>
<% end %>
